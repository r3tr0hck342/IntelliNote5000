# Apple Release Checklist (macOS + iOS/iPadOS)

This guide assumes you are developing on macOS Sonoma or newer with Node 20.x already installed.

## 1. Accounts & Tooling
- [ ] Apple Developer Program membership (Individual or Company) is active.
- [ ] Install Xcode (latest stable) from the App Store and accept the license (`sudo xcodebuild -license`).
- [ ] Install Xcode Command Line Tools: `xcode-select --install`.
- [ ] Install Rust toolchain for Tauri desktop builds: `curl https://sh.rustup.rs -sSf | sh` (default options), then `rustup target add aarch64-apple-darwin x86_64-apple-darwin`.
- [ ] Install `tauri-cli`: `cargo install tauri-cli`.
- [ ] Install CocoaPods (needed by Capacitor): `sudo gem install cocoapods`.
- [ ] Ensure Android tooling is **not** required (this checklist is Mac/iOS only).

## 2. Project Configuration
- [ ] Decide which AI providers you will ship with (Gemini for live transcription, OpenAI-compatible for text workflows).
- [ ] For development/testing, you may keep `VITE_API_KEY`, `VITE_AI_PROVIDER`, and `VITE_AI_BASE_URL` in `.env.local` to prefill default credentials, but **production binaries rely on the runtime Settings UI**, so every end user must paste their own key.
- [ ] After installing JavaScript dependencies, run `npm run verify:providers` to ensure every configured provider meets validation rules.
- [ ] Install the secure storage dependencies (`capacitor-secure-storage-plugin`) and run `npx cap sync ios` so iOS builds include the Keychain-backed plugin.
- [ ] The repo ships with `.npmrc` setting `legacy-peer-deps=true` to satisfy the plugin’s peer-dependency constraints with Capacitor 6—keep that file in place until upstream updates their peer range.
- [ ] Confirm package metadata:
  - `package.json` `name`, `version`, and `productName`/`identifier` fields in `src-tauri/tauri.conf.json`.
  - Capacitor bundle ID in `capacitor.config.ts` matches App Store Connect app record (e.g., `com.intellinote.app`).
- [ ] Update app icons and splash screens for macOS, iPhone, and iPad resolutions (store assets under `src-tauri/icons` and in the Xcode asset catalog generated by Capacitor).
- [ ] Run `npm install` to ensure lockfile is up to date with Node 20.

## 3. Local Verification (Web Build)
1. `cp .env.example .env.local` and add a valid fallback `VITE_API_KEY` (optional).
2. `npm run dev` – verify live transcription (Gemini only), OpenAI-compatible flows, uploads, and theming.
3. `npm run build` – ensure the production bundle is generated in `dist/` without errors.
4. From the Settings modal, switch between Gemini and any other enabled providers to confirm both pathways behave as expected (live transcription should gray out when Gemini is not selected).
5. `npm run verify:providers` – confirm provider metadata invariants remain intact.

## 4. macOS (Tauri) Build & Submission
1. **Prepare signing assets**
   - Create identifiers in App Store Connect + Certificates, Identifiers & Profiles: macOS App ID `com.intellinote.app`.
   - Generate a “Mac App Development” certificate for local testing and a “Mac App Distribution” certificate for the App Store.
   - Create provisioning profiles for both.
2. **Configure Tauri signing**
   - Export the signing identities to your keychain.
   - Set `TAURI_SIGNING_IDENTITY` (distribution) and `APPLE_ID`, `APPLE_PASSWORD`/App-Specific password as env vars if you plan to use automatic notarization.
   - Update `src-tauri/tauri.conf.json` `macOS.signingIdentity` or rely on env vars.
3. **Build**
   ```bash
   npm run build            # web assets
   npm run build-desktop    # tauri build (universal binary)
   ```
4. **Test locally**
   - Install the generated `.app`/`.dmg` from `src-tauri/target/release/bundle/macos`.
   - Verify microphone permission prompts, file-system availability, offline mode, and the runtime AI provider selection flow.
5. **Notarize**
   - Use `xcrun notarytool submit` on the `.pkg`/`.dmg` generated by Tauri or enable `tauri.conf.json > bundle > notarize`.
6. **Distribute via App Store Connect**
   - Upload the `.pkg` or `.dmg` using Transporter or `xcrun altool`.
   - Fill out App Store metadata (screenshots, description, privacy questionnaire, contact info).
   - Submit for review after passing App Store automated checks.

## 5. iOS/iPadOS (Capacitor) Build & Submission
1. **Sync Capacitor**
   ```bash
   npm run build
   npm run sync-mobile      # runs `npx cap sync`
   npx cap open ios         # opens Xcode workspace
   ```
2. **Xcode configuration**
   - In Xcode, set the team, bundle identifier, signing certificates, and deployment targets for each scheme (iPhone/iPad).
   - Enable microphone usage description keys in `Info.plist` (e.g., `NSMicrophoneUsageDescription`).
   - Configure “Supports multiple windows”/iPad settings if needed.
3. **Assets & Capabilities**
   - Add app icons and splash screens in `App/App/Assets.xcassets`.
   - Ensure Background Modes are disabled unless required.
   - Verify entitlements for network, microphone, file access, and that the secure storage plugin is present after running `npx cap sync`.
4. **Testing**
   - Run on physical iPhone and iPad devices.
   - Validate microphone permissions, offline fallback, provider selection UI, and any native integrations from `utils/native`.
5. **Archive & Upload**
   - In Xcode, choose `Product > Archive`.
   - Validate the archive, fix any warnings, then upload to App Store Connect (TestFlight).
6. **TestFlight QA**
   - Create internal test groups, invite testers, collect feedback.
   - Once stable, submit the same build for App Review with finalized metadata and privacy responses.

## 6. QA Checklist (Both Platforms)
- [ ] App version numbers incremented (semantic) for every submission.
- [ ] All strings, dialogs, and permissions prompts are accurate and user-friendly.
- [ ] Offline behavior gracefully informs the user when AI requests fail (all configured providers).
- [ ] Crash reporting/analytics (if any) respect privacy requirements.
- [ ] App Privacy report completed on App Store Connect (data collection, usage).
- [ ] Screenshots for Mac, iPhone, and iPad uploaded with correct resolutions.
- [ ] Review “Export Compliance” questions (no encryption beyond standard Apple APIs).

## 7. Launch
- [ ] Schedule release (manual or automatic) in App Store Connect for both macOS and iOS apps.
- [ ] Monitor App Review feedback, respond promptly if rejections occur.
- [ ] After approval, announce release, monitor crash logs, and prepare hotfix builds if needed.

Following this checklist ensures you can go from the current codebase to an App Store-ready build on modern macOS/iOS hardware with Node 20+. Update the checklist as your product requirements evolve.
